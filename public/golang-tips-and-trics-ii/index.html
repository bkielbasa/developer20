<!DOCTYPE html>
<html lang="en-us">
    <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>Golang Tips &amp; Tricks #2 - interfaces &middot; Developer 2.0</title>

		
  		<link rel="stylesheet" href="/css/style.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">
		
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

		
		<link href="" rel="alternate" type="application/rss+xml" title="Developer 2.0" />
	</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/">
					<h2 class="nav-title">Developer 2.0</h2>
				</a>
				<ul>
    <li><a href="/about">About</a></li>
    <li><a href="/">Posts</a></li>
</ul>
			</div>
		</nav>

        

<main>
	<div class="post">
		<div class="post-info">
    <span>Written by</span>
        Bart≈Çomiej Klimczak
        <br>
        <span>on&nbsp;</span><time datetime="2019-03-11 00:00:00 &#43;0000 UTC">March 11, 2019</time>

    
</div>

		<h1 class="post-title">Golang Tips &amp; Tricks #2 - interfaces</h1>
<div class="post-line"></div>

		

		<p>When it comes to interfaces, a good practice is to create an interface where you&rsquo;ll use it. Creating interfaces in advanced is not recommended in Go. There are two exceptions:</p>

<ul>
<li>you&rsquo;re creating a library which will be used in different projects</li>
<li>you&rsquo;ll have more than 1 implementation</li>
</ul>

<p>In the example below, we have a storage implementation.</p>

<pre><code class="language-go">type inMemoryStorage struct {
   mutex *sync.Mutex
   storage map[string]*Value
}

func NewStorage() *inMemoryStorage {
   return &amp;inMemoryStorage{
      storage: map[string]*Value{},
      mutex: &amp;sync.Mutex{},
   }
}

func (s inMemoryStorage) Set(ctx context.Context, value *Value) error  {
   s.mutex.Lock()
   s.storage[value.key] = value
   s.mutex.Unlock()
   return nil
}

func (s inMemoryStorage) Get(ctx context.Context, key string)  (*Value, error)  {
   if val, ok := s.storage[key]; ok {
      return val, nil
   }

   return nil, nil
}

func (s inMemoryStorage) GetAll(ctx context.Context)  map[string]*Value  {
   return s.storage
}

func (s inMemoryStorage) Remove(ctx context.Context, key string) error  {
   s.mutex.Lock()
   delete(s.storage, key)
   s.mutex.Unlock()
   return nil
}
</code></pre>

<p>As you can see, we skipped the interface(s) because they are not needed here.</p>

<p>Why do we have this rule? Imagine the situation when you add the interface next to the implementation. The interface is used for abstracting (dependency injection). The interface can look like the below.</p>

<pre><code class="language-go">type Storager interface {
   Set(ctx context.Context, value *Value) error
   Get(ctx context.Context, key string) (*Value, error)
   GetAll(ctx context.Context) map[string]*Value
   Remove(ctx context.Context, key string) error
}
</code></pre>

<p>The problem with the approach comes, for example, in testing. In our production code, you may use only Set method, but you have to mock all of them. It&rsquo;s better to split the interface to smaller parts and define only those methods which are really needed.</p>

<pre><code class="language-go">type Remover interface {
   Remove(ctx context.Context, key string) error
}
</code></pre>


		

	</div>

	<div class="pagination">
		<a href="/golang-tips-and-trics-i/" class="left arrow">&#8592;</a>
		<a href="/golang-tips-and-trics-iii/" class="right arrow">&#8594;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>


        		<footer>
			<span>
			&copy; <time datetime="2019-08-18 12:24:38.155732 &#43;0200 CEST m=&#43;0.055585771">2019</time> . Made with <a href='https://gohugo.io'>Hugo</a> using the <a href='https://github.com/EmielH/tale-hugo/'>Tale</a> theme.
			</span>
		</footer>

    </body>
</html>
